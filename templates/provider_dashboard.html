{% extends 'base1.html' %}

{% load static %}
{%block title %} Electricity Provider Dashboard{% endblock %}

{% block content %}
<main class="main-content min-vh-100 col-md-9 ms-sm-auto col-lg-10 px-md-4">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Electricity Provider Dashboard</h1>
    </div>

    <div class="container mt-5">
        <!-- Active Bids Table -->
        <h3 class="mt-4">Active Bids</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Customer Name</th>
                    <th>Bid Amount (Rate per kWh)</th>
                    <th>Expiration Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for bid in active_bids %}
                    <tr>
                        <td>{{ bid.customer_profile.user.get_full_name }}</td>
                        <td>${{ bid.bid_amount }}</td>
                        <td>{{ bid.expiration_date }}</td>
                        <td>
                            <a href="{% url 'view_bid' bid.id %}" class="btn btn-info btn-sm">View</a>
                            <a href="{% url 'edit_bid' bid.id %}" class="btn btn-warning btn-sm">Edit</a>
                            <a href="{% url 'withdraw_bid' bid.id %}" class="btn btn-danger btn-sm">Withdraw</a>
                        </td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4">No active bids.</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Completed Transactions Table -->
        <h2>Completed Transactions</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Customer Name</th>
                    <th>Energy Purchased (kWh)</th>
                    <th>Total Payment</th>
                    <th>Date of Transaction</th>
                </tr>
            </thead>
            <tbody>
                {% for transaction in completed_transactions %}
                    <tr>
                        <td>{{ transaction.customer_profile.user.get_full_name }}</td>
                        <td>{{ transaction.energy_purchased }}</td>
                        <td>£{{ transaction.total_payment }}</td>
                        <td>{{ transaction.date }}</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4">No completed transactions.</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Rate Settings -->
        <h2>Rate Settings</h2>
        <form method="post">
            {% csrf_token %}
            <div class="mb-3">
                <label>Current Buyback Rate(p/kWh):</label>
                <input type="text" class="form-control" value="£{{ rate_setting.current_buyback_rate }}" disabled>
            </div>
            <div class="mb-3">
                <label for="new_buyback_rate">New Buyback Rate(p/kWh):</label>
                <input type="text" name="new_buyback_rate" id="new_buyback_rate" class="form-control" value="{{ rate_setting.new_buyback_rate }}">
            </div>
            <div class="mb-3">
                <label for="effective_date">Effective Date:</label>
                <input type="date" name="effective_date" id="effective_date" class="form-control" value="{{ rate_setting.effective_date }}">
            </div>
            <button type="submit" name="update_rate" class="btn btn-primary">Update Rate</button>
        </form>
    </div>

</main>
{% endblock %}